// locals: item
// optional: new_date

form method="POST" action=(item.id ? path_to(:budget_record).with(item.id) : path_to(:budget))
  table
    tr
      td Date:
      td
        input type="text" name="date" value=(item.date ? item.date : new_date) tabindex="1"
    tr
      td Amount:
      td
        input type="text" name="amount" value=(item ? item.amount : 0) tabindex="2"
        select name="currency"
          - $currencies.each do |k,v|
            option value=k selected=("selected" if item && (item.currency_id == k)) = v.title
      td
        input type="checkbox" checked=(item.is_conversion == true ? 'checked' : nil) name="is_conversion"
      td is conversion
    tr
      td Tag:
      td
        input#tag-autocomplete type="text" value=(item ? $tags[item.tag_id][:title] : "") tabindex="3"
        span#tag-id-label style="opacity: 0.5; padding-left: 8px;" = "id: #{item ? item.tag_id : 0}"
        input#tag-id-field style="width: 20px; text-align: center;" name="tag_id" value=(item ? item.tag_id : 0) tabindex="-1" type="hidden"
      td @
      td
        input#shop-autocomplete type="text" name="shop" value=(item ? item.shop : "") tabindex="4"
    tr
      td Desc:
      td colspan="3"
        textarea name="description" style="width: 100%; height: 80px;" tabindex="5"
          = item ? item.description : ""
    tr
      td Purse:
      td
        select name="purse" tabindex="6"
          - $purse.each do |k,v|
            option value=k selected=("selected" if item && item.purse == k) = v
    tr
      td
    tr
      td
      td
        input type="submit" value="Submit" tabindex="7"

ruby:
  tags_array = []
  $tags.each { |k,v| tags_array << {value: (v[:parent] ? $tags[v[:parent]][:title] + '/' + v[:title] : v[:title]), id: k} }

javascript:
  $(function(){
    var tags = #{{tags_array.to_json}};
    $("#shop-autocomplete").autocomplete({
      source: "#{path_to(:autocomplete_shop)}",
      minLength: 2
    });
    $("#tag-autocomplete").autocomplete({
      source: tags,
      minLength: 1,
      select: function(event,ui){
        $("#tag-autocomplete").val(ui.item.value);
        $("#tag-id-field").val(ui.item.id);
        $("#tag-id-label").html("id: " + ui.item.id);

        return false;
      }
    });
  });
